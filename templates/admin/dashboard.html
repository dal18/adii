{% extends "admin/layout.html" %}

{% block title %}Dashboard - Logbook System{% endblock %}
{% block nav_page_title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item active">Dashboard</li>
{% endblock %}

{% block content %}
<style>
    .small-box.bg-info { background: linear-gradient(135deg, var(--primary) 0%, var(--sidebar-hover) 100%) !important; }
    .small-box.bg-success { background: linear-gradient(135deg, var(--accent) 0%, #e6ac00 100%) !important; }
    .small-box.bg-warning { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%) !important; }
    .small-box.bg-danger { background: linear-gradient(135deg, var(--secondary) 0%, #b30d20 100%) !important; }
</style>
<div class="row">
    <!-- Total Entries Card -->
    <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
            <div class="inner">
                <h3>{{ total_entries }}</h3>
                <p>Total Entries</p>
            </div>
            <div class="icon">
                <i class="fas fa-book"></i>
            </div>
            <a href="{{ url_for('admin_logbook_index') }}" class="small-box-footer">
                More info <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    
    <!-- Today's Entries Card -->
    <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
            <div class="inner">
                <h3>{{ today_entries }}</h3>
                <p>Today's Entries</p>
            </div>
            <div class="icon">
                <i class="fas fa-calendar-day"></i>
            </div>
            <a href="{{ url_for('admin_logbook_index', filter='today') }}" class="small-box-footer">
                More info <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    
    <!-- Male Visitors Card -->
    <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h3>{{ gender_stats.get('Male', 0) }}</h3>
                <p>Male Visitors</p>
            </div>
            <div class="icon">
                <i class="fas fa-male"></i>
            </div>
            <a href="{{ url_for('admin_logbook_index') }}" class="small-box-footer">
                More info <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
    
    <!-- Female Visitors Card -->
    <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
            <div class="inner">
                <h3>{{ gender_stats.get('Female', 0) }}</h3>
                <p>Female Visitors</p>
            </div>
            <div class="icon">
                <i class="fas fa-female"></i>
            </div>
            <a href="{{ url_for('admin_logbook_index') }}" class="small-box-footer">
                More info <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Gender Breakdown Chart -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Gender Breakdown</h3>
            </div>
            <div class="card-body">
                <canvas id="genderChart" style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Recent Entries -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Recent Entries</h3>
            </div>
            <div class="card-body p-0">
                {% if recent_entries %}
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Purpose</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in recent_entries %}
                        <tr>
                            <td>{{ entry['date'] }}<br><small class="text-muted">{{ entry['time'] }}</small></td>
                            <td>{{ entry['name'] }}</td>
                            <td><span class="badge badge-info">{{ entry['purpose'] }}</span></td>
                            <td>
                                <a href="{{ url_for('admin_logbook_show', id=entry['id']) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-2"></i>
                    <p class="text-muted">No entries yet</p>
                </div>
                {% endif %}
            </div>
            <div class="card-footer">
                <a href="{{ url_for('admin_logbook_index') }}" class="btn btn-primary btn-sm">
                    View All Entries <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Gender Breakdown Chart
    const genderCtx = document.getElementById('genderChart');
    if (genderCtx) {
        const genderData = {
            labels: ['Male', 'Female', 'Other'],
            datasets: [{
                data: [
                    {{ gender_stats.get('Male', 0) }},
                    {{ gender_stats.get('Female', 0) }},
                    {{ gender_stats.get('Other', 0) }}
                ],
                backgroundColor: ['#17a2b8', '#dc3545', '#ffc107'],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        };
        
        new Chart(genderCtx, {
            type: 'doughnut',
            data: genderData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    }
</script>
{% endblock %}
